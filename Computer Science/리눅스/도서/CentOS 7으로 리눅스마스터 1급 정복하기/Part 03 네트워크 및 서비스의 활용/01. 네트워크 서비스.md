# 네트워크 서비스

# 1.1 웹 관련 서비스

## 1.1.1 웹 관련 서비스의 이해

### 웹의 개요

웹: 월드 와이드 웹의 약자로 인터넷에 연결된 컴퓨터들을 통해 문서나 정보를 공유할 수 있도록 구성한 정보 공간이자 서비스, 하이퍼 텍스트 방식과 멀티미디어 환경에서 정보 검색 가능

하이퍼텍스트: 각 페이지나 문서에 있는 하이퍼링크를 통해 다른 문서나 다른 페이지로 이동할 수 있는 형태, HTML이라는 태그를 이용해 만듦

<br>

### 웹 서비스 구성 요소

웹 서버: 웹 브라우저와 같은 클라이언트로부터 HTTP 요청을 받아 정보제공자가 작성한 웹페이지나 웹 문서를 전달하는 역할 수행

<br>

웹 문서(HTML 문서)

- 개요: 초기 웹 서버는 정적인 HTML 문서만을 제공하였는데 이후 인터넷이 대중화되며 동적인 콘텐츠 제공 시작

  CGI(Common Gateway Interface)를 이용하여 서버 프로그램과 외부 프로그램 연계

- HTML 문서: 지정된 태그를 이용해 만드는 문서

  ```html
  <HTML>
  	<HEAD>
  		<TITLE>문서 제목</TITLE>
  	</HEAD>
  	<BODY>
  		본문 내용
  	</BODY>
  </HTML>
  ```

<br>

웹 브라우저

웹 서버와 통신하며 HTML 문서나 파일을 연동, 출력하는 프로그램으로 HTTP 프로토콜로 통신함

- 파이어폭스
- 오페라
- 크롬

<br>

### 웹 작동 원리

웹 브라우저: HTTP 클라이언트

웹 서버: HTTP 서버

HTTP 클라이언트는 HTTP 서버에 요청 방식(HTTP Method), URI, 프로토콜 버전, MIME 등을 전송하고 HTTP 서버는 데이터, 상태 코드 등으로 응답

<br>

주요 HTTP 요청 메소드

| 메소드 | 설명                                   |
| ------ | -------------------------------------- |
| GET    | 서버에서 자료를 가져오는 요청          |
| POST   | 서버에 정보를 저장하도록 하는 요청     |
| HEAD   | GET과 유사하나 HTTP 헤더 정보만 가져옴 |
| PUT    | 서버에 자료를 올릴 때 사용             |
| DELETE | 서버의 자료를 삭제할 때 사용           |

HTTP 요청에 대한 상태 코드는 HTTP 규약(RFC 2616)에 정의되어 있음

<br>

## 1.1.2 웹 관련 서비스의 운영

### 웹 서버 설치의 개요

Apache HTTP: 전 세계적으로 가장 많이 사용되는 웹 서버

리눅스에서 동적인 웹 페이지 구성을 하기 위해서는 PHP와 MySQL을 연계해서 사용, 해당 조합을LAMP라고 부름

<br>

### Apache HTTP 서버와 PHP

PHP로 작성한 문서가 아파치에서 HTML처럼 해석되기 위해서는 아파치에 PHP를 모듈로 장착해야 함

- 정적 모듈 장착: PHP가 아파치에 완전히 고정되기 때문에 처리 속도가 빠름, 사용자가 많고 PHP가 많이 사용되는 경우 유리

  아파치나 PHP 업데이트 시 두 가지 프로그램을 다시 설치해야 함

- 동적 모듈 장착: DSO라고 하며 사용자의 요청이 있을 때 해당 프로세스에 포함되는 방식

  자원의 효율성면에서 유리하며 아파치 2.0 버전 이후 동적 모듈 방식으로만 컴파일해서 설치 가능

<br>

### Apache 2.x의 개요

아파치 1.3 버전: 클라이언트의 요청 하나를 하나의 프로세스가 담당하는 프로세스 기반의 동작 방식으로 웹 서버의 접속자 수가 많아지면 처리를 위한 프로세스의 수도 같이 증가

아파티 2.x 버전: 스레드 기능을 이용하여 하나의 프로세스가 다수의 클라이언트 요청 처리 (멀티 스레딩 지원, MPM)

주요 MPM 모듈

- prefork: 아파치 1.3 프로세스 모듈과 같은 방법으로 각 요청에 프로세스가 매핑됨

  프로세스를 제어하는 부모 프로세스는 클라이언트의 요청이 들어올 경우를 대비해 대기하고 있다가 자식 프로세스의 생성 여부 등을 관리하는 방식

- worker: 초기에 시작하는 프로세스의 개수를 지정하고 페이지 요청이 들어오면 스레드로 처리하는 방식

  프로세스 당 처리하는 스레드의 개수를 지정하고 지정된 스레드 수를 초과할 경우 새로운 자식 프로세스를 생성하여 처리하는 방식

<br>

## 1.1.3 웹 서버와 부가 서비스의 연동 설치

### Apache, MySQL, PHP 연동 설치

Apache, PHP: configure → make → make install

MySQL: cmake → make install

<br>

### Apache HTTP Server 설치

사전 준비 사항

1. C 및 C++ 컴파일러 설치
2. XML parser 라이브러리 설치
3. apr 및 apr-util 소스 파일 다운로드 및 압축 해제
4. PCRE(Perl-Compatible Regular Expression) 설치

<br>

httpd 2.4 설치

1. 웹 데몬 정지
2. 이전 버전의 httpd 검색 및 삭제
3. 다운로드한 소스 파일이 위치한 디렉터리로 이동 후 압축 해제
4. 압축 해제 후 생성된 디렉터리로 이동
5. 환경 설정
6. 컴파일 실행
7. 설치 실행

<br>

### Apache 2.4 디렉터리 구조

아파치를 소스 컴파일로 /usr/local/apache에 설치하면 다음과 같은 디렉터리가 생성됨

- bin: 아파치 서버 운영에 필요한 데몬 및 실행 유틸리티들 위치
- build: 아파치 생성과 관련된 여러 스크립트들이 위치
- cgi-bin: cgi 스크립트가 위치
- conf: 아파치의 환경 설정 파일이 들어 있는 디렉터리
  - extra: 추가적인 서버 설정 파일들이 위치
  - original: httpd.conf, extra 원본 백업
- error: 에러 발생 시 보여 주는 에러 문서 위치
- htdocs: 웹 문서들이 위치
- icons: 아파치에서 사용되는 아이콘들이 위치
- include: 헤더 파일들이 위치
- lib: 아파치 서버 운영에 필요한 라이브러리들이 위치
- logs: 아파치 서버 운영 시에 발생하는 여러 log들이 위치
- man: 아파치 관련 매뉴얼 파일이 위치하는 디렉터리로 기존의 man 디렉터리에 복사하여 사용
- manual: 웹 서버 상에서 아파치 관련 매뉴얼 문서를 확인할 수 있도록 제공하는 디렉터리
- modules: 아파치에서 사용하는 모듈 파일 위치

<br>

### Apache 2.4 웹 서버 설정

아파치 2.2 버전부터 서버 운영에 필요한 최소한의 설정만 httpd.conf 파일에서 하고 나머지 설정은 extra 디렉터리 안에 위치한 여러 파일들을 이용

extra 디렉터리 안의 파일

- httpd-mpm.conf: MPM 관련 설정 파일

- httpd-multilang-errordoc.conf: 에러 처리 문서에 대한 설정 파일

- httpd-autoindex.conf: 디렉터리 목록을 표시해줄 때 여러 가지 설정을 하는 파일

- httpd-userdir.conf: 개인 사용자의 홈 디렉터리 설정 시 사용하는 파일

- httpd-info.conf: 웹 브라우저를 이용하여 웹 서버의 상태 정보 파악 시 사용

- httpd-vhosts.conf: 버추얼 호스트 사용 시 설정하는 파일

- httpd-dav.conf: WebDAV 관련 설정 파일

  WebDDAV: 웹 기반 분산형 저작 및 버전 관리로 웹 서버에서 파일 관리를 할 수 있는 확장된 HTTP 프로토콜

- httpd-default.conf: Timeout 등 서버 운영의 기본적인 설정을 하는 파일

- httpd-languages.conf: 문서의 언어 표시 관련 설정 파일

- httpd-manual.conf: 운영 중인 서버 상에서 아파치의 매뉴얼 문서를 볼 수 있게 설정하는 파일

- httpd-ssl.conf: SSL 관련 설정 파일

- proxy-html.conf: HTML 4 및 XHTML 1을 이해하기 위해 mod_proxy_html을 설정하는 파일

<br>

### Apache 웹 서버 실행

- httpd 명령을 이용한 실행

  ```bash
  httpd [option] [filename]
  
  ## 주요 옵션 ##
  # -t: 환경 설정 파일인 httpd.conf의 문법적 오류를 검사
  # -f: 새로 설정한 conf 파일이 있을 경우에 그 설정 파일로 아파치 데몬을 구동할 때 사용
  # -S: 설정이 되어 있는 가상 호스트 출력
  # -l: 정적 컴파일된 모듈에 대한 목록 출력
  # -k: httpd 데몬에 시그널을 보내는 옵션으로 stop, start, restart, graceful 등을 인자값으로 지정해 사용
  # -M: 정적 컴파일 모듈과 공유 모듈을 전부 출력
  # -V: httpd에 빌드된 파라미터와 버전 정보 출력
  ```

- 스크립트 파일을 이용한 실행

  ```bash
  apachectl command
  ```

  | 명령               | 설명                                                         |
  | ------------------ | ------------------------------------------------------------ |
  | help               | 간단한 도움말 출력                                           |
  | start              | 아파치 데몬 시작                                             |
  | stop               | 아파치 데몬 중지                                             |
  | restart            | 아파치 데몬 재시작                                           |
  | reload             | 아파치 데몬을 재시작하지 않고 환경 설정 파일만 다시 읽어들임 |
  | configtest         | httpd.conf 파일의 문법적 오류 검사                           |
  | graceful           | 웹 서버에 연결된 접속을 차단하지 않고 httpd.conf의 설정을 다시 읽어들임 |
  | graceful-stop      | 웹 서버에 연결된 접속은 차단하지 않고 httpd 데몬을 중지      |
  | status, fullstatus | 웹 서버의 상태를 간단히 또는 전체적으로 출력 (mod_status라는 모듈이 설치되어 있고 httpd.conf의 <Location /server-status> 영역이 설정되어 있어야 해당 명령 제공 가능) |

<br>

## 1.1.4 웹 서버 운영

### Apache 사용자 인증

설정 절차

1. 사용자 생성 및 사용자 계정 파일 생성
2. httpd.conf 파일에 인증할 디렉터리 관련 설정
3. 인증할 디렉터리에 관련 정보를 담고 있는 .htaccess 파일 생성

<br>

.htaccess 지시자

| 지시자       | 설명                                       |
| ------------ | ------------------------------------------ |
| AuthType     | 인증 형태를 지정 (Basic/Digest)            |
| AuthName     | 웹 브라우저 인증 창에 표시되는 메시지 설정 |
| AuthUserFile | 사용자 계정 파일명 설정                    |
| Require      | 접속을 허가할 사용자 설정                  |

<br>

htpasswd: 아파치 사용자 인증 파일을 생성/관리해 주는 명령

```bash
htpasswd [option] 계정파일 사용자명

## 주요 옵션 ##
# -c: 사용자 계정 파일을 생성할 때 사용하는 옵션으로 계정 생성 시 한 번은 반드시 사용해야 함
```

## 1.1.5 MySQL과 연동

<br>

## 1.1.6 기타 다른 서비스와의 연동

### 웹 서버 암호화

웹 서버를 통해 주고받는 데이터들은 평문으로 전송하기 때문에 패킷 캡처링 도구를 이용해 알아낼 수 있음

이때 콘텐츠 보호를 위해 사용되는 것이 SSL, SSL을 확장하여 표준화한 것이 TLS임

SSL/TLS의 동작 원리: 최초 3-way handshake 후에 비밀키 생성, 해당 대칭키 암호화가 데이터 암호화를 위해 사용됨

웹 서버에서 SSL을 사용하게 되면 443 포트를 사용하는 https 프로토콜을 이용하게 됨

SSL은 전송 계층의 암호화 방식이기 때문에 HTTP뿐만 아니라 다른 응용 계층 프로토콜에서도 사용 가능

<br>

# 1.2 인증 관련 서비스

## 1.2.1 인증 관련 서비스의 이해

### 인증의 개요

네트워크 기반 인증 서비스: 하나의 서버에 사용자 관련 정보 저장, 나머지 다수의 다른 서버에 사용자, 암호, 그룹 정보 등을 제공하는 서비스 (NIS, LDAP 등)

<br>

### NIS(Network Information Service)의 개요

네트워크 기반으로 여러 가지 정보를 제공해주는 서비스로 하나의 서버에 등록된 사용자 계정, 암호, 그룹 정보 등을 공유하여 다른 시스템에 제공

<br>

### LDAP(Lightweight Directory Access Protocol)의 개요

경량 디렉터리 접근 규약으로 DAP 기반으로 만들어진 디렉터리 데이터베이스에 접속하기 위한 통신 규약

DAP는 OSI 프로토콜 스택에서 작동되고 컴퓨터 자원을 많이 사용하는 단점이 있어 보완하기 위해 등장

LDAP는 IP 프로토콜을 기반으로 사용자, 시스템, 네트워크, 서비스 정보 등의 디렉터리 정보 공유 가능, RDBMS에 비해 검색 속도가 빠름

하나 이상의 속성을 가진 객체로 구성되고 그 객체를 엔트리라고 부름, 각각의 엔트리는 DIT(Directory Information Tree)라 부르는 트리 구조에 의해 조직화되고, 이 조직 내에서 고유한 식별자인 DN(Distinguisbed Name)으로 구성되고 DN은 RDN(상대 고유 이름)으로 구성됨

<br>

## 1.2.2 인증 관련 서버 관리

### NIS 설정법

NIS 구성을 위한 작업

1. RPC 관련 데몬 실행

   ```bash
   systemctl start rpcbind
   systemctl enable rpcbind
   ```

2. /etc/hosts 파일 수정: NIS 서버 및 클라이언트 모두 각각의 IP 주소 및 도메인 등록

<br>

NIS 서버 구성법

- NIS 서버용 패키지명: ypserv

  패키지 아래 NIS 서버 데몬 스크립트

  - ypserv: NIS 서버를 운영하는 주 데몬 스크립트
  - yppasswdd: NIS 클라이언트에서 패스워드 시에 적용되도록 해주는 데몬 스크립트
  - ypxfrd: NIS 서버와 NIS 클라이언트 간의 매핑 속도를 높여주는 데몬 스크립트

- NIS 서버 설정 절차

  1. NIS 도메인 설정
  2. 계정 생성
  3. 관련 데몬 시작
  4. NIS 서버 작동 확인
  5. 관련 정보 갱신
  6. NIS 서버의 재시작
  7. 부팅 시 NIS 관련 서버 활성화

<br>

### NIS 클라이언트 구성법

NIS 클라이언트를 사용하기 위해서는 ypbind와 yp-tools라는 패키지가 설치되어 있어야 함

NIS 클라이언트 설정 절차

1. NIS 도메인 설정
2. NIS 서버와 nisdomain 설정
3. 관련 데몬 시작
4. 관련 서버의 동작 확인
5. 부팅 시 NIS 클라이언트 데몬 활성화

<br>

### NIS 관련 명령어

- nisdomainname: NIS 도메인명을 보여주거나 설정하는 명령

  ```bash
  nisdomainname [도메인명]
  ```

- ypwhich: NIS 클라이언트에서 사용하는 명령어로 NIS 서버명과 관련 맵 파일을 보여줌

  ```bash
  ypwhich [option]
  
  ## 주요 옵션 ##
  # -m: NIS 서버의 맵 파일 출력
  ```

- ypcat: NIS 클라이언트에서 사용하는 명령어로 맵 파일의 내용을 확인함

  ```bash
  ypcat 맵_파일명
  ```

- yptest: NIS 클라이언트에서 관련 설정을 테스트

  ```bash
  yptest
  ```

- yppasswd: NIS 클라이언트에서 NIS 서버에 등록된 사용자의 패스워드를 변경

  ```bash
  yppasswd 사용자명
  ```

- ypchsh: NIS 클라이언트에서 NIS 서버에 등록된 사용자의 셸을 변경

  ```bash
  ypchsh 사용자명
  ```

- ypchfn: NIS 클라이언트에서 NIS 서버에 등록된 사용자의 정보 변경

  ```bash
  ypchfn 사용자명
  ```

<br>

# 1.3 파일 관련 서비스

## 1.3.1 삼바(SAMBA) 서버 관리

### 삼바의 개요

SMB(Server Message Block) 프로토콜을 이용하여 리눅스를 비롯한 유닉스 계열 운영체제와 윈도우 운영체제 간의 자료 공유 및 하드웨어를 공유할 수 있게 해 줌

SMB 프로토콜은 유닉스와 윈도우 환경을 동시에 지원하는 CIFS(Common Internet File System)로 확장됨

CIFS는 IEFT에 의해 인터넷 표준으로 제안됨

<br>

### 삼바 설치의 개요

삼바 관련 주요 RPM 패키지

- samba: 삼바 서버 패키지
- samba-common: 삼바 서버와 클라이언트 모두에게 필요한 패키지
- samba-client: 삼바 클라이언트 명령어가 들어 있는 패키지

<br>

### 삼바 관련 데몬 및 서버 설정 절차

삼바 데몬

- smbd: 파일과 프린터 공유, 사용자의 권한 부여 및 확인 등 가용자 인증을 담당
- nmbd: WINS를 담당하는 데몬으로 클라이언트를 위해 NetBIOS nameserver 지원, IP 주소 연결 등의 역할 수행

<br>

삼바 서버의 설정 절차

1. 접근 관련 설정
2. 삼바 관련 데몬 시작
3. 서버 동작과 관련 메시지 확인
4. 관련 서버의 동작 확인
5. 삼바 서버의 재시작
6. 부팅 시 삼바 관련 서버 활성화

일반 사용자 접근과 관련된 삼바 서버는 SELinux에 의해 기본적으로 접근이 차단되어 있음

→ 차단 해제 방법: setenforce 0

<br>

### 환경 설정 파일: smb.conf

삼바 서버를 제어하고, 공유시킬 시스템 자원에 대한 다양한 설정을 함

/etc/samba 디렉터리 안에 존재하며, 파일 구성은 윈도우 환경 설정 파일 win.ini와 비슷함

[ ] 를 이용해 섹션으로 구분하고 설정함

<br>

smb.conf 파일 내부의 유형

- \#으로 시작하는 행: 주석으로 간주되어 무시됨
- ;으로 시작하는 행: 주석으로 간주되어 무시됨, 설정행이 작동하지 않도록 설정하거나 설명을 추가할 때 사용
- [ ]을 사용하는 행: 섹션을 정의하는 역할을 하고, 하나의 섹션이 정의된 후 그 다음 섹션이 정의될 때까지의 행들은 해당 섹션에 속함
- name = value 행: 사용하는 옵션과 해당 값을 설정하는 행

<br>

smb.conf의 주요 섹션

- [global]: 삼바 서버의 전체적인 환경 설정을 담당하는 섹션
- [homes]: 각 사용자들이 자신의 홈 디렉터리로 접근할 때의 권한을 설정하는 섹션
- [printers]: 프린터 관련 권한을 설정하는 섹션

<br>

### 관련 명령어

- smbclient

  리눅스 및 유닉스에서 사용하는 삼바 클라이언트 명령으로 윈도우 서버로 접근 시 사용됨

  ftp 클라이언트 명령과 유사하게 접속 후 특정 명령어를 입력하여 작업을 수행함

  ```bash
  smbclient [option] [호스트명]
  
  ## 주요 옵션 ##
  # -L: 접속하려는 삼바 서버의 공유 디렉터리 정보 출력
  # -U: 삼바 서버에 접속할 때 사용자명을 입력
  # -M: 지정한 호스트명에 메시지를 전송할 때 사용 (전송하려면 ctrl + d)
  ```

- smbstatus

  삼바 서버에 사용하는 명령어로 클라이언트와 연결된 상태를 출력

  ```bash
  smbstatus
  ```

- testparm

  삼바의 환경 설정 파일인 smb.conf의 설정 여부 확인

  ```bash
  testparm [파일경로] [호스트명 IP주소]
  ```

- nmblookup

  WINS 서버에 질의할 때 사용하는 명령으로 DNS 서버에 질의하는 nslookup 명령과 유사

  ```bash
  nmblookup [option]
  
  ## 주요 옵션 ##
  # -U: 조회할 서버 이름 지정
  # -R: 조회할 이름 지정
  ```

- mount.cifs

  CIFS 기반의 마운트 명령으로 보통 윈도우에 공유된 디렉터리를 마운트할 때 사용

  mount 명령에서 CIFS 파일 시스템을 마운트하는 형식인 mount -t eifs를 대체

  ```bash
  mount.cifs //공유서버/디렉터리 /마운트할_디렉터리
  ```

- smbpasswd

  삼바 사용자를 생성 및 삭제, 패스워드 변경, 활성 및 비활성화 등 관련 정보를 변경하는 명령

  ```bash
  smbpasswd [option] [사용자명]
  
  ## 주요 옵션 ##
  # -a: 삼바 사용자를 추가할 때 사용, 삼바 사용자는 리눅스 시스템에 존재하는 계정이어야 함
  # -x: 삼바 사용자를 제거할 때 사용
  # -d: 삼바 사용자를 일시적으로 비활성화할 때 사용
  # -e: 삼바 사용자를 활성화할 때 사용
  # -n: 패스워드 없이 로그인이 가능하도록 할 때 사용
  ```

- pdbedit

  삼바 사용자의 데이터베이스 파일인 SAM database를 관리해주는 명령

  ```bash
  pdbedit [option] [사용자명]
  
  ## 주요 옵션 ##
  # -a: 삼바 사용자를 추가할 때 사용
  # -L: 등록된 삼바 사용자의 간단한 목록 출력
  # -v: 등록된 삼바 사용자의 정보를 자세히 출력
  ```

<br>

## 1.3.2 NFS(Network File System) 서버 관리

### NFS의 개요

TCP/IP 네트워크상에서 다른 컴퓨터의 파일 시스템을 마운트하고 공유하여 상대방의 파일 시스템 일부를 자기 자신의 디렉터러인 것처럼 사용할 수 있게 함

RPC(Remote Procedure Call) 기반으로 작동되므로 해당 서비스를 해 주는 rpcbind 데몬을 먼저 실행해야 함

<br>

### NFS 관련 주요 RPM 패키지

- rpcbind: RPC 기반 연결을 위해 필요한 패키지
- nfs-utils: NFS 서버 관련 패키지로 관련 데몬 및 명령어를 포함함

<br>

### NFS 서버 설정의 개요

NFS 서버의 환경 및 접근 데어는 /etc/exports에서 설정

NFS 서버 설정 순서

1. 접근 관련 설정
2. NFS 관련 데몬 시작
3. 서버 동작과 관련 메시지 확인
4. 관련 서버 동작의 확인
5. NFS 서버의 재시작
6. 부팅 시 NFS 관련 서버 활성화

<br>

### 환경 설정 파일: /etc/exports

설정 시 줄 단위로 외부에 공유할 디렉터리를 입력하고 공백(TAB)으로 구분한 후 허가할 호스트를 지정 및 옵션 기입

공유할_디렉터리   허가할_호스트(옵션)   [허가할_호스트(옵션) …]

주요 옵션

- ro: 읽기 전용으로 지정하는 옵션으로 기본값
- rw: 읽기 및 쓰기가 가능하도록 지정하는 옵션
- root_squash: NFS 클라이언트에서 접근하는 root 사용자를 무시하고 서버상의 nobody(또는 nfsnobody)로 매핑시키는 옵션으로 기본값, 일반 사용자의 권한은 그대로 인정됨
- no_root_squash: NFS 클라이언트에서 접근하는 root 사용자를 무시하지 않고 root로 인정
- no_subtree_check: 하위 디렉터리를 검사하지 못하도록 할 때 설정
- all_squash: root를 포함하여 모든 사용자의 권한을 nobody(또는 nfsnobody)로 매핑, 반대 옵션에 해당하는 no_all_squash는 기본 적용됨
- secure: 포트 번호가 1024 이하의 요청에만 허가할 때 사용, 기본값이며 반대 설정은 insecure
- sync: 변경 사항이 안정적으로 저장된 경우에만 관련 요청에 응답하도록 함, 기본값
- async: 쓰기가 설정된 디스크 스토리지에 사용하면 유용한 옵션으로 데이터 변경에 대비해 비동기적 처리를 할 때 사용
- anonuid: 접근하는 사용자 권한을 지정하는 uid로 매핑시킬 때 사용
- anongid: 접근하는 그룹 권한을 지정하는 gid로 매핑시킬 때 사용

<br>

### NFS 클라이언트에서 사용법

1. mount 및 mount.nfs 명령 이용
2. /etc/fstab 등록

<br>

### 관련 명령어

- rpcinfo

  rpc 관련 정보를 출력해주는 명령

  ```bash
  rpcinfo [option] [호스트명]
  
  ## 주요 옵션 ##
  # -p: 등록된 rpc 프로그램의 정보를 출력
  # -s: 관련 정보를 간결하게 출력
  ```

- exportfs

  NFS 서버에 익스포트 된 디렉터리 정보를 관리해 주는 명령

  ```bash
  exportfs [option] [호스트명]
  
  ## 주요 옵션 ##
  # -v: 설정된 내용을 자세히 출력
  # -r: /etc/exports에 설정된 내용을 다시 읽어들임
  # -a: 모두라는 의미로 한번에 익스포트된 디렉터리를 호출 시 사용
  # -u: 익스포트된 하나 이상의 디렉터리를 해제할 때 사용
  ```

- showmount

  NFS 서버의 마운트 관련 정보를 출력하는 명령

  NFS 클라이언트에서 NFS 서버에 익스포트된 정보를 확인할 때도 사용

  ```bash
  showmount [option] [호스트명]
  
  ## 주요 옵션 ##
  # -a: '호스트명:디렉터리' 형태로 출력
  # -e [호스트명]: 익스포트된 리스트를 보여줌
  # -d: NFS 클라이언트에 의해 마운트된 디렉터리 목록 정보 출력
  ```

- nfsstat

  NFS 관련 상태 정보를 출력하는 명령으로 NFS 서버와 클라이언트에서 모두 사용 가능

  ```bash
  nfsstat [option]
  
  ## 주요 옵션 ##
  # -c: NFS 클라이언트 관련 정보만 출력
  # -s: NFS 서버 관련 정보만 출력
  ```

<br>

## 1.3.3 FTP(File Transfer Protocol) 서버 관리

### FTP의 개요

FTP: TCP/IP 프로토콜 기반으로 서버와 클라이언트 사이에 파일을 주고받기 위한 프로토콜

vsftpd: 리눅스에서 사용하는 대표적인 FTP 서버 프로그램

<br>

### vsftpd 서버 설정

vsftpd 관련 주요 파일

- /etc/vsftpd/vsftpd.conf: vsftpd의 환경 설정 파일
- /etc/pam.d/vsftpd: vsftpd PAM 관련 설정 파일
- /etc/vsftpd/ftpusers: PAM 관련 설정 파일인 /etc/pam.d/vsftpd에 사용되는 파일로 기본 설정이 접근 거부될 사용자 목록으로 이동
- /etc/vsftpd/user_list: 사용자 목록 파일로 허가 또는 거부 목록 파일로 사용 가능
- /etc/logrotate.d/vsftpd: 로그 로테이트 관련 파일

<br>

# 1.4 메일 관련 서비스

## 1.4.1 메일 관련 서비스의 이해

### 메일 관련 프로토콜

- SMTP(Simple Mail Transfer Protocol): 인터넷에서 이메일을 보낼 때 사용하는 프로토콜로 메일 서버 간의 송수신뿐 아니라 메일 클라이언트에서 메일 서버로 메일을 보낼 때 사용 (TCP 포트: 25)

- POP3(Post Office Protocol Version 3): 서버에 도착한 메일을 클라이언트에서 직접 받아 읽도록 해 주는 프로토콜 (포트: 110)

  구현이 용이하고 기존의 많은 클라이언트 프로그램이 지원한다는 장점이 있음

  메일을 확인하면 클라이언트로 메일을 가져온 후 서버에서 메일을 지우기 때문에 다시 메일을 확인할 수 없음

- IMAP(Internet Mail Access Protocol): 클라이언트 사용자가 메일 서버에 도착한 메일을 확인할 때 사용 (포트: 143)

  메일을 확인한 후에도 서버에 해당 메일이 계속 존재하여 다른 곳에서 메일 확인이 가능하나 메일 서버의 통신 트래픽을 높임

<br>

### 메일 관련 프로그램의 분류

- MTA(Mail Trasfer Agent): 이메일을 SMTP 프로토콜을 이용해 다른 메일 서버로 전달하는 프로그램 (보통 메일 서버 프로그램을 지칭)
- MUA(Mail User Agent): 사용자가 메일을 읽고 보낼 때 사용하는 프로그램
- MDA(Mail Delivery Agent): 메일박스에 도착한 메일을 대행해서 가져오거나 전달하는 역할을 수행

<br>

### 리눅스와 메일 관련 프로그램

리눅스에서 많이 사용하는 메일 서버 프로그램에는 sendmail, qmail, postfix 등이 사용되고 POP3 및 imap 서버로 dovecot이 많이 사용됨

<br>

## 1.4.2 메일 서버 설치 및 활용

### sendmail의 개요

sendmail 관련 주요 환경은 /etc/mail/sendmail.cf 파일에서 설정

실질적인 메일 운영과 관련된 설정은 별도의 파일을 이용해서 관리

sendmail.cf 파일의 내용이 변경되면 데몬을 재시작하지만 다른 파일들은 별도의 db 파일로 변환해야 하기 때문에 각 파일에 맞는 명령을 별도로 실행시켜야 함

<br>

### /etc/mail/sendmail.cf

비어있는 행과 #은 무시됨

설정과 관련된 항목은 C, D, F, H, K, M, O, P, R, S, V로 시작

<br>

### sendmail 관련 주요 파일

- /etc/mail/local-host-names: 메일 서버에 사용하는 도메인을 설정하는 파일로 한 줄에 도메인 하나씩 기입

- /etc/mail/sendmail.mc: sendmail의 매크로 설정 파일로 [sendmail.cf](http://sendmail.cf) 파일을 복원하는 경우 m4라는 매크로 프로세서를 이용해 새롭게 생성 가능

  sendmail-cf 패키지를 설치해야 함

- /etc/mail/access: 메일 서버로 접근하는 호스트나 도메인의 접근을 제어하는 파일

  첫 번째 필드에 도메인명, IP 주소, 메일 계정 등을 기입하고 두 번째 필드에 정책을 적으면 됨

  변경 시 makemap hash 명령을 이용한 업데이트 필요

  주요 정책

  - RELAY: 특정 호스트나 도메인의 접근 허용
  - REJECT: 메일을 거절하고 거부 메시지를 보냄
  - DISCARD: 메일을 거부 메시지 없이 무조건 거절
  - OK: DNS 조회가 되지 않은 경우라도 들어오는 메일을 허가, 보통 거부된 도메인에 대한 예외 처리 시 사용

- /etc/aliases: 특정 계정으로 들어오는 메일을 다른 계정으로 전송되도록 설정

  변경 시 newaliases, sendmail -bi, sendmail -l 명령을 실행해야 적용됨

- /etc/mail/virtusertable: 하나의 메일 서버에 여러 도메인을 사용하는 환경에서 동일한 메일 계정을 요구할 때 각각의 도메인으로 도착하는 메일을 포워딩할 때 사용

  변경 시 makemap hash 명령을 이용한 업데이트 필요

- ~/.forward: 각 사용자 개인이 자신에게 들어오는 메일을 다른 메일 주소로 포워딩할 때 사용

  .forward 파일의 퍼미션 값은 해당 사용자에게만 쓰기 권한이 설정되어야 함

<br>

### sendmail 관련 주요 명령어

- mailq: 보내는 메일이 대기하는 디렉터리의 큐 상태를 출력해주는 명령

  ```bash
  mailq [option]
  
  ## 주요 옵션 ##
  # -Ac: /etc/mail/submit.cf 파일에 명시된 큐의 상태를 출력
  ```

- sendmail: sendmail 관리 명령

  ```bash
  sendmail option
  
  ## 주요 옵션 ##
  # -bp: mailq와 같은 명령으로 메일 큐의 상태 출력
  # -bi: newaliases 같은 명령으로 /etc/aliases 파일 수정 시 관련 DB 정보 파일 업데이트
  # -oQ: -bp와 같이 사용되는 옵션으로 특정 큐의 상태를 확인하기 위해 사용
  ```

<br>

# 1.5 DNS 관리

## 1.5.1 DNS의 이해

DNS(도메인 네임 시스템): 호스트의 도메인 이름을 IP 주소로 바꾸거나 그 반대의 변환을 위해 개발됨 → IP 주소 기반의 인터넷 체계에서 도메인명 기반으로 이용하기 위해서는 DNS 서버를 필수적으로 구성해야 함

<br>

### DNS 서버의 종류

- Primary Name Server: 사용하는 도메인을 관리하기 위해 필수적으로 구성하는 서버로 보통 Master DNS라고 부름

  도메인 등록 시 이 서버의 IP 주소를 등록하고 자체 도메인에 대한 정보를 관리하게 됨

- Secondary Name Server: Slave DNS라고도 부르며 Primary Name Server의 zone 파일을 백업하는 역할을 수행

  외부클라이언트에서 이 서버를 2차 DNS 서버로 설정하면 Master DNS가 다운된 상태라도 정상적으로 해당 도메인에 대해 리졸빙 정보를 제공

- Caching Name Server: 관리하는 도메인 없이 리졸빙만을 제공하기 위해 구성하는 서버

  도메인에 대한 리졸빙 결과를 저장하고 서버에 기록된 정보에 대한 요청이 들어올 경우 직접 조회하지 않고 바로 응답해주는 역할을 수행

  인터넷 사용 속도를 높이기 위해 사용되기도 함

<br>

### DNS 서버 프로그램: BIND(Berkeley Internet Name Domain)

bind: 가장 널리 쓰이는 DNS 서버 프로그램

데몬명은 named를 사용

bind 관련 파일 및 디렉터리

- /etc/named.conf: DNS 서버의 전반적인 환경 설정을 담당하는 파일로 서버에서 사용하는 zone 파일을 지정
- /var/named: 루트 토메인 서버에 대한 정보를 담고 있는 named.ca를 비롯해 사용자가 선언하는 zone 파일 등이 위치하는 디렉터리

<br>

## 1.5.2 DNS 관리 및 활용

### DNS 서버 설정의 개요

DNS 서버 설정 핵심 파일

- /etc/named.conf 파일: DNS 서버 환경 설정 및 운영하는 도메인에 대한 존 파일과 리버스 존 파일 지정
- zone 파일: 도메인에 대한 정보를 담고 있는 파일 (지정된 경로에 정해진 포맷으로 생성함)

<br>

### /etc/named.conf 파일

파일의 구성과 특징

- 파일은 크게 주석문과 구문으로 구성
- 주석은 /* */, //, # 등 모두 사용 가능
- 구문에는 options, logging, controls, zone 등이 존재
- 각 구문은 중괄호로 둘러싸고 끝날 때는 세미콜론 사용
- include 지시자를 선언하여 별도의 파일에 추가 정의 가능

<br>

주요 구문

- option: DNS 서버의 동작 및 제어와 관련된 여러 가지 설정을 하는 영역으로 존 파일이 위치하는 디렉터리 명은 반드시 명기해야 함

- acl: Access Control List의 약자로 여러 호스트를 하나의 명칭으로 지정할 때 사용

  지정한 이름은 options 구문의 allow-query, allow-transfer 등에 사용 가능, acl 구문의 선언은 options 구문 이전에 해야 함

  acl에서 사용 가능한 주소 매칭 이름

  - any: 모든 호스트를 나타냄
  - none: 어떤 호스트도 거부함
  - localhost: 시스템에 부여된 IPv4 및 IPv6 주소를 매칭
  - localnet: 시스템에 부여된 IPv4 및 IPv6 네트워크의 모든 호스트를 매칭

- zone: 도메인을 관리하는 데이터베이스 파일인 zone 파일을 지정

  루트 도메인 서버에 대한 정보 파일인 named.ca에 대한 선언이 되어 있고 추가적으로 localhost, domain 등에 대한 존 파일이 선언되어 있음

  CentOS 7에서는 include 지시자를 사용해 root zone 파일 관련 설정을 제외한 zone 구문 자체를 별도의 파일에서 설정하도록 권장

  일반적인 zone 파일: 도메인에 대한 질의 시 IP 주소로 알려 주는 역할 수행

  리버스 존 파일: IP 주소에 대한 질의 시 도메인을 알려 주는 역할 수행

/etc/named.conf 파일의 분할

CentOS 7 버전에서는 root zone 파일 관련 설정을 제외한 다른 zone 파일 관련 설정은 /etc/named.rfc912.zones에서 설정하도록 권장

<br>

### zone 파일

zone 파일의 개요

zone 파일은 /etc/named.conf 파일에 지정된 디렉터리에 지정된 파일명으로 생성해야 함

기본 설정 디렉터리는 /var/named이며 파일명은 /etc/named.rfc1912.zones에 설정함

zone 파일을 vi 같은 편집기로 생성하는 경우 소유권 및 허가권을 변경하지 않으면 DNS 서버가 동작하지 않을 수 있음

zone 파일의 구조

- SOA 레코드
- 자원 레코드

zone 파일의 항목

- $TTL: Time To Live의 약자로 zone 파일의 첫 줄에 설정해야 함

  다른 서버에서 도메인 관련 정보를 조회해 가져갔을 경우 그쪽 서버의 캐시에 해당 정보가 얼마나 머물지 결정 (초 단위)

- SOA record: 존 파일을 시작하는 레코드로 도메인명 또는 @를 사용하여 시작

  항목 설명이 필요한 경우 ;을 사용하여 주석 가능

  - nameserver: 네임 서버의 호스트명과 도메인명을 적으며 전체 도메인으로 기입할 경우 마지막에 루트 도메인을 뜻하는 .을 찍어야 함
  - contact_email_address: 관리자의 이메일 주소를 적으며 계정.도메인 형태로 기입
  - serial_ number: 일련 번호
  - refresh_number: 보조 네임 서버가 자신의 정보를 업데이트하기 위해 주 네임 서버에 얼마나 자주 체크할 것인지 설정
  - retry_number: 보조 네임 서버가 주 네임 서버 접근에 실패했을 셩우에 재시도할 주기 설정
  - expire_number: 보조 네임 서버가 주 네임 서버에 접근을 실패하여 재시도할 때 만기 시간
  - minimum_number: 일종의 SOA 영역의 TTL로서 가져간 정보의 최소 보관 시간

- 도메인: 도메인명, 호스트명, 공백, @, * 등이 올 수 있음

- TTL: 해당 레코드에 대한 TTL 값을 설정하는 항목으로 생략한 경우 $TTL 항목에 설정된 값이 반영됨

- class: 레코드의 클래스를 지정하는 부분으로 IN, CH, HS 등이 사용 가능함 (생략 가능)

- type: 해당 레코드의 타입을 지정하는 영역

  - A: IPv4의 주소 기입 시 사용
  - AAAA: IPv6의 주소 기입 시 사용
  - NS: 도메인의 네임 서버 지정 시 사용
  - MX: 메일 서버를 지정할 때 사용, MX 다음에 0 또는 양의 정수 값을 기입해 우선 순위를 지정해야 함
  - CNAME: Canonical Name 레코드로 일종의 별칭 지정 시 사용
  - PTR: 리버스 존에서만 사용하는 레코드로 IP 주소를 도메인으로 변환하기 위해 지정

- Rdata: IP 주소, 도메인명, 호스트명을 지정하는 영역

<br>

### DNS 관련 유틸리티

- named-checkconf: DNS 서버의 환경 설정 파일인 /etc/named.conf 파일의 문법적 오류를 찾아주는 명령

  ```bash
  named-checkconf [파일명]
  ```

- named-checkzone: zone 파일의 문법적 오류를 찾아주는 명령

  ```bash
  named-checkzone 도메인명 zone_파일경로
  ```

<br>

# 1.6 가상화 관리

## 1.6.1 가상화 서비스의 이해

### 가상화의 정의 및 개요

가상화: 한 컴퓨터의 물리적 시스템 자원을 여럿으로 나누거나 다수의 컴퓨터들의 물리적 자원을 하나로 묶어서 제공하는 기술

물리적 자원들을 논리적 자원들의 형태로 표시하는 기술로 물리적 자원을 이용하는 사용자에게는 논리적 형태로만 나타남

<br>

### 가상화의 기능

- 공유

  다수의 많은 가상 자원들이 하나의 동일한 물리적 자원과 연결되어 있거나 가리키는 것

  물리적 자원의 일부를 가상화된 자원마다 할당하거나 물리적 자원에 대해 시분할 기법으로 공유하는 방식이 주로 사용됨

- 단일화

  공유의 반대되는 개념으로 외견상 전체 용량을 증가시키고 활용과 관리를 단순화 가능

- 에뮬레이션

  물리적 자원에는 존재하지 않았으니 가상 자원에는 어떤 기능을 처음부터 존재했던 것처럼 가질 수 있음

  또 다른 형태의 에뮬레이션에는 여러 개의 제각기 다른 물리적 자원들을 표준 구성요소 형태인 것처럼 가상 자원으로 표시하는 것이 있음

- 절연

  가상화된 자원들과 물리적 자원들 간의 상호 매핑은 가상화 자원들 또는 가상화 자원들을 사용하는 사용자들에게 아무런 영향을 미치지 않으며 물리적 자원들이 교체될 수 있도록 해 줌

  장애방지의 효과

<br>

### 가상화의 효과

- 높아진 자원 활용률

  물리적 자원들과 자원 풀에 대한 동적인 공유를 가능하게 해 주며 이를 통해 더 높은 자원 활용률을 얻을 수 있음

- 낮아진 관리 비용과 관리의 용이성

  관리해야 하는 물리적 자원의 대수를 줄여줌으로써 관리 인력의 생산성 향상 가능

- 사용의 유연성

- 향상된 보안

  장애가 전체 시스템에 전파되는 것을 방지

- 높아진 가용성

  사용자 레벨에 영향을 주지 않고 물리적 자원이 제거되거나 업그레이드될 수 있도록 지원

- 증가된 확장성

- 상호운영성

  기존 물리적 자원들 간에 불가능한 인터페이스와 프로토콜 레벨의 호환성 제공

- 향상된 프로비저닝

  프로비저닝: 사용자의 요구사항에 맞게 할당, 배치, 배포할 수 있도록 만들어 놓는 것

<br>

### 서버 가상화 정의 및 특징

서버 가상화: 하나의 물리적 서버에 운영체제, 애플리케이션, 미들웨어들이 서로 어떠한 영향을 미치지 않으면서 동시에 사용될 수 있도록 해주는 기술

<br>

### 서버 가상화의 분류

- 하드웨어 레벨 가상화

  가상화 계층이 물리적인 하드웨어 또는 호스트 운영체제 위에 위치하여 가상화 계층에 의해 생성된 가상머신에 게스트 운영체제를 생성

  VMM이 가장 큰 특징이며 VMM은 게스트 운영체제의 자원 활용을 관리하는 업무 수행

  VMM 구성 위치에 다음과 같이 나눔

  - 전가상화: 전가상화 및 반가상화는 가상 머신의 하드웨어를 에뮬레이팅하는 개신 하이퍼바이저라는 제어 프로그램을 통해 호스트의 하드웨어 자원을 가상 머신의 여러 운영체제가 나누어 사용하도록 하는 기법

    전가상화는 가상화 소프트웨어가 수정하지 않은 게스트 운영체제를 100% 완전 가상화 환경 위에서 제공하는 기술

  - 반가상화: 게스트 운영체제 측면에서 VMM과의 원활한 통신을 위해 게스트 운영체제의 커널 일부분을 수정하여 적용

    일부 가상화 하드웨어 자원에 대해 필요에 따라 직접적으로 물리적 하드웨어 접근을 일부 허용

  - 호스트 기반 가상화: VMM이 호스트 운영체제 위에 설치되어 가상머신을 생성하는 구조로 게스트 운영체제는 호스트 운영체제가 인식한 하드웨어를 가상 하드웨어로 재구성하여 사용하는 방법

- 운영체제 레벨 가상화

  하나의 CPU에 하나의 운영체제만 수행되고 가상화 계층이 호스트 운영체제 윗부분에 존재하여 가상화 환경을 제공하는 방법

  단일 호스트 운영체제 위에 다중 애플리케이션 전용 컨테이너를 생성하여 애플리케이션 단위의 가상화 환경 제공

  - Containers 방식: 가상화 계층이 호스트 운영체제 내에 임베디드 형태로 구성되고 각각의 애플리케이션별로 추가적인 컨테이너를 생성하는 방식
  - Hardware Emulator 방식: 애플리케이션 중심의 가상 운영체제를 생성하는 과정에서 소프트웨어적으로 하드웨어를 가상 에뮬레이팅하는 방식

- 하이레벨 언어 가상화

  특정 컴퓨터 프로그램 언어를 이용하여 가상 머신 환경을 구성하는 기술

  가장 범용적으로 적용되고 있으나 실질적인 가상화 운영체제 구성 목적보가는 특정 애플리케이션에 대한 호스트 운영체제 및 하드웨어와 독립적인 환경을 구성하기 위한 목적으로 사용됨

<br>

### 리눅스 기반 서버 가상화 기술의 분류 및 특징

오픈소스 서버 가상화 기술 분류

- 제1세대: 하나의 물리적 서버에 하이퍼바이저를 이용하여 여러 개의 가상 머신을 생성/삭제/운영하는 수준의 기술

  유휴 자원이 많이 남는 다수의 물리적 서버를 하나의 서버로 통합하여 운영 시 유용

- 제2세대: 다수의 물리적 서버 자원을 통합하여 관리 기능을 제공하는 기술

- 제3세대: 다양한 하이퍼바이저들을 통합 관리하기 위한 플랫폼

<br>

### 관련 기술 동향

- 쿠버네티스: 컨테이너화된 애플리케이션의 배포, 확장, 관리를 자동화함

- 앤서블: 소프트웨어 프로비저닝, 구성 관리, 배포 프로그램

  서버에서 동일한 작업 수행 시 한 번에 원격에서 처리하도록 해 줌

<br>

## 1.6.2 가상화 서비스 구축

<br>

## 1.6.3 가상화 서비스의 운영

### 게스트 운영체제 시작 및 종료

- 가상 머신 관리자 이용

- virsh 명령 이용

  가상머신을 관리해주는 도구로 생성, 상태 정보 출력, 일시 정지 등의 기능 제공

  ```bash
  virsh # 대화식 터미널 모드 진입
  virsh command [argument] # 명령행에서 직접 실행
  
  ## 주요 command ##
  # help: 사용법과 관련된 도움말 정보 출력
  # list: 가상 머신 관련 정보 출력
  # shutdown: 가상 머신을 정상 종료
  # destroy: 가상 머신을 강제 종료
  # start: 가상 머신 시작
  # suspend: 가상 머신 일시 정지
  # resume: 가상 머신 재가동
  # net-list: 네트워크 목록 정보 출력
  # net-destroy: 네트워크 장치 강제 종료
  # net-undefine: 비활성된 네트워크 장치의 정의 해제
  ```

<br>

### 시스템 리소스 확인

- CPU 자원 사용량 확인: virt-top 명령 이용

<br>

# 1.7 기타 서비스

## 1.7.1 슈퍼 데몬 관리

### 슈퍼 데몬의 개요

슈퍼 데몬: 다른 데몬을 관리하고 제어하는 역할을 수행하는 inetd를 의미

inetd 방식은 단독 데몬 방식인 standalone에 비해 처리 속도는 느리지만 메모리가 부족하고 다양한 서비스를 제공해야 하는 시스템에서는  효율적임

<br>

### TCP Wrapper

TCP Wrapper

tcpd라는 데몬이 슈퍼 데몬에 의해 수행되는 서비스들의 접근을 제어하도록 하는 프로그램

주로 TCP 연결을 기반으로 함

커널 2.4 이후에는 xinetd에서 자체적으로 접근 제어를 수행하나 tcp wrapper를 사용한 접근 제어도 가능

접근 허가 후 접근 금지를 진행하기 때문에 접근 허가 파일에 등록 시 접근 금지 파일에 상관없이 허가됨

systemd 체계로 바뀌면서 사용 빈도 감소

<br>

관련 파일 작성 규칙

/etc/hosts.allow 및 /etc/hosts.deny 파일 설정 시 새로운 줄은 무시되고 줄 연장 시 \를 사용해야 함

빈 줄 혹은 #로 시작되는 줄은 주석으로 간주됨

<br>

설정 형식

daemon_list : client_list [ : shell_command]

- daemon_list: 한 개 이상의 데몬 프로세스 혹은 예약어 사용 가능

  여러 데몬 명기 시 ,로 구분

  예약어 종류

  - ALL
  - LOCAL: 같은 도메인에 있는 모든 호스트로 . 문자를 포함하지 않는 모든 호스트
  - KNOWN
  - UNKNOWN
  - PARANOID: 호스트명과 주소가 일치하지 않는 호스트
  - 가 EXCEPT 나: 리스트 가에서 나를 제외한 모든 호스트

- client_list: 한 개 이상의 호스트 이름, 주소, 패턴 혹은 예약어를 쓸 수 있음, 일반적으로 IP 주소나 도메인을 기입

- shell_command: spawn과 twist 사용 가능

  spawn:  현재 수행 중인 프로세스의 자식 프로세스로 실행됨

  twist: 프로세스의 이미지를 교체한 후에 실행

  확장 옵션

  - %a (%A): 클라이언트의 주소
  - %c: 클라이언트의 정보
  - %d: 데몬 프로세스의 이름
  - %h (%H): 클라이언트의 호스트명 또는 주소
  - %n (%N): 클라이언트의 호스트명
  - %p: 데몬의 프로세스 아이디
  - %s: 서버의 정보
  - %u: 클라이언트 사용자명

<br>

### xinetd

xinetd: 리눅스 커널 2.4 버전부터 슈퍼 데몬인 inetd를 대체하기 위해 등장

환경 설정 파일을 이용해 접근 제어를 하기 때문에 자체적으로 접근 제어가 가능

<br>

xinetd의 구성

- /etc/xinetd.conf: xinetd 데몬의 전체적인 환경 설정을 담당하는 파일
  - log_type: 어떠한 형태로 로그를 저장할 것인지 지정 (SYSLOG와 FILE 두 가지 설정 가능)
  - log_on_failure: 접속 실패 시 기록될 속성값 지정
  - log_on_success: 접속 성공 시 기록될 속성값 지정
  - cps: 초당 요청받은 수에 대한 제한 설정
  - instances: 동시에 서비스할 수 있는 서버의 최대 개수 지정 (접속 제한을 두지 않는 경우 UNLIMITED로 설정)
  - per_source: 특정 IP 주소에서 접속할 수 있는 최대 개수 지정
  - only_from: 서비스를 이용할 수 있는 원격 호스트 설정
  - no_access: 서비스를 이용할 수 없는 원격 호스트의 설정, only_from과 중복 설정된 경우 차단
  - enabled: 사용 가능할 서비스의 목록 지정, 해당 파일에 설정된 서비스는 각 서비스 설정 파일에서 ‘disable = yes’라고 설정되어 있어고 서비스를 허가
  - disabled: 특정 서비스의 사용을 막을 때 사용하는 항목으로 enabled 항목과 중복 설정되면 enable 항목이 무시되어 해당 서비스가 실행되지 않음
  - includedir /etc/xinetd.d: 각 서비스들의 설정 파일들이 위치하는 디렉터리
- /etc/xinetd.d: xinetd 데몬에 의해 관리 및 제어되는 서비스 파일들이 위치하는 디렉터리

xinetd의 전체적인 환경은 /etc/xinetd.conf에서 설정하지만 관련 서비스에 대한 자세한 설정은 /etc/xinetd.d 디렉터리 안에 파일을 생성하고 값을 부여함

서비스명은 /etc/services 파일에 등록된 이름을 사용해야 함

<br>

## 1.7.2 프록시(Proxy) 관리

Proxy 서버

자주 방문하는 사이트의 정보를 저장하는 일종의 캐시 서버로 사용자들이 동일한 사이트를 접속하는 경우 서버에 저장된 데이터 정보를 전달함으로써 처리 속도를 높임

네트워크 속도가 느린 환경에서 보다 빠른 인터넷을 이용하기 위해 사용

투명 프록시를 구성했을 경우 네트워크 보안을 유지할 때도 사용 가능

리눅스에서 프록시 서버 프로그램으로 squid를 주로 사용

<br>

### squid

고성능의 웹 캐싱 서버로 HTTP, Gopher, FTP 등을 지원

프록시 서버의 접근 제어

squid.conf 파일에서 acl 항목을 이용해 접근 제어 가능

acl을 이용하여 특정 IP 주소, 네트워크 대역, 도메인 등을 별칭 형태로 지정하고 http_access allow나 http_access deny를 이용하여 접근을 제어함

중복 정책인 경우 먼저 설정된 정책이 반영됨

<br>

## 1.7.3 DHCP(Dynamic Host Configuration Protocol) 관리

### DHCP 서버의 개요

DHCP 서버: 클라이언트에게 자동으로 IP 주소, Gateway 주소, Name Server 주소 등을 할당해 주는 서버로 보통 가정에서 ISP 업체를 통해 인터넷 서비스를 이용하는 경우 기본적으로 사용됨

DHCP는 IPv4 체계의 IP 주소 고갈 문제를 해결할 수 있고 하나의 인터넷 회선을 공유하는 매스커레이드 환경에서 자동으로 클라이언트에게 IP 주소를 할당해 줄 수 있음

하드디스크가 없는 원격 호스트에서 이더넷 카드로 부팅 시에도 사용 가능

<br>

관련 프로토콜

- BOOTP(Bootstrap Protocol): 초기 적재 통신 규약으로 부르며 하드 디스크가 없는 장치에 IP 주소 등을 할당하고 관리하기 위해 개발된 프로토콜

  UDP를 사용하고 유닉스 초기 시절에 TFTP와 함께 사용됨

- DHCP: 동적 호스트 설정 통신 규약이라고 부르고 시스템에 IP 주소 등을 자동 할당 및 관리하기 위해 사용됨

  BOOTP와 다르게 할당된 IP 주소에 임대 기간 설정 가능

<br>

### DHCP 서버의 설치 및 운영

주요 파일

- /etc/dhcp/dhcpd.conf: DHCP 서버의 환경 설정 파일

  클라이언트에 할당할 주소 대역을 subnet 및 netmask 선언 후 { } 안에 필요한 항목들을 지정

  주요 항목을 별도로 적으면 모든 네트워크에 적용되며 특정 호스트에 고정적인 IP 주소를 할당하려면 host 호스트명 { } 형태로 선언

- /usr/share/doc/dhcp-*/dhcpd.conf.example: dhcpd.conf 파일의 실질적인 설정 내용이 들어있는 일종의 샘플 파일

  해당 파일을 /etc/dhcp/dhcpd.conf 파일로 복사하면 됨

<br>

## 1.7.4 VNC 관리

### VNC(Virtual Network Computing)의 정의 및 개요

VNC: RFB(Remote Frame Buffer) 프로토콜을 이용하여 원격의 다른 컴퓨터에서 그래픽 환경 기반으로 데스크톱을 공유할 수 있는 시스템

키보드 및 마우스가 발생한 이벤트를 다른 컴퓨터로 전송시켜 그래픽 화면을 갱신하는 방식으로 제공

<br>

### VNC의 구성 요소

VNC를 이용하기 위해서는 VNC 서버 프로그램과 VNC 클라이언트 프로그램(VNC Viewer)을 설치해야 함

<br>

## 1.7.5 NTP(Network Time Protocol) 관리

### NTP의 개요

컴퓨터 간의 시간을 동기화하는데 사용되는 프로토콜로 NTP 서버를 구성하면 클라이언트들의 시간을 1/1000초까지 동기화시킬 수 있음

UTC를 기준으로 사용

Stratum 1부터 가장 낮은 Stratum 15까지 15단계로 난고 Stratum 16은 비동기 장치를 나타냄

최상단인 Stratum 1에 해당하는 NTP 서버는 라디오 클럭과 외부 타임 소스 액세스를 가지고 시간을 동기화하고 Stratum 2 서버는 1 서버로부터, 3 서버는 2 서버로부터 시간을 가져오는 형태로 동기화됨

<br>

### 관련 명령어

- ntpq: NTP 질의 응답 명령어

  ```bash
  ntpq [option]
  
  ## 주요 옵션 ##
  # -p: 연결된 서버의 상태 출력
  ```

- ntpdate: NTP 서버를 이용해 시간 동기화 시 사용